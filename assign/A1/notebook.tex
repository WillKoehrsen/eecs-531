
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{Feature Detection}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \hypertarget{feature-detection}{%
\section{Feature Detection}\label{feature-detection}}

\hypertarget{will-koehrsen-wjk68}{%
\subsection{Will Koehrsen wjk68}\label{will-koehrsen-wjk68}}

In this notebook we will implement a basic feature detection process.
Given an a template image of an object and a target image, we will
create a model to find all the instances of the template image within
the target image.

Feature detection of this sort can be done using \texttt{matchTemplate}
in openCV which uses convolution to find the response to the template in
the target image. By applying a threshold to the result, we can then
identify the most likely locations of the template object. This approach
can be used to find a single occurrence of the template (find the
maximum response) or many (all responses above a threshold). Altering
the threshold will change the location on a given curve on the Receiver
Operating Characteristic (ROC) graph but will not shift the curve.
Location on the curve is determined by True Positives and False
Positives. The curve itself is determined by the signal to noise ratio
in the target and template image.

In addition to using openCV, I also implemented feature detection using
\texttt{fftconvolve} from
\href{https://docs.scipy.org/doc/scipy/reference/signal.html}{scipy.signal}.
This is the same approach used by openCV. Given a template image and a
target image, the template is convolved with the target image
(multiplied at every location) to find a response. The response is
normalized, and then either the maximum response can be found (to find a
single occurrence) or all responses above a specified threshold can be
identified. To show the results, we can plot the magnitude of the
response as well as the original image with the detected feature(s).
Again, altering the threshold will change the position along a given
curve on the ROC graph.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        
        \PY{k+kn}{import} \PY{n+nn}{cv2}
        \PY{k+kn}{from} \PY{n+nn}{PIL} \PY{k}{import} \PY{n}{Image}
        
        \PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{signal} \PY{k}{import} \PY{n}{fftconvolve}
        
        \PY{k+kn}{import} \PY{n+nn}{os}
        
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
        \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k}{import} \PY{n}{cm}
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
\end{Verbatim}


    \hypertarget{opencv-implementation}{%
\subsection{OpenCV Implementation}\label{opencv-implementation}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{k}{def} \PY{n+nf}{detect\PYZus{}features\PYZus{}opencv}\PY{p}{(}\PY{n}{target\PYZus{}image\PYZus{}path}\PY{p}{,} 
                                   \PY{n}{template\PYZus{}path}\PY{p}{,} \PY{n}{number} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{one}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{threshold}\PY{o}{=}\PY{l+m+mf}{0.75}\PY{p}{)}\PY{p}{:}
            
            
            \PY{n}{method} \PY{o}{=} \PY{n+nb}{eval}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cv2.TM\PYZus{}SQDIFF}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            
            \PY{k}{if} \PY{n}{number} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{one}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                \PY{n}{target} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{target\PYZus{}image\PYZus{}path}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
                \PY{n}{template} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{template\PYZus{}path}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
                \PY{n}{h}\PY{p}{,} \PY{n}{w} \PY{o}{=} \PY{n}{template}\PY{o}{.}\PY{n}{shape}
                \PY{n}{res} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{matchTemplate}\PY{p}{(}\PY{n}{target}\PY{p}{,} \PY{n}{template}\PY{p}{,} \PY{n}{method}\PY{p}{)}
                \PY{n}{min\PYZus{}val}\PY{p}{,} \PY{n}{max\PYZus{}val}\PY{p}{,} \PY{n}{min\PYZus{}loc}\PY{p}{,} \PY{n}{max\PYZus{}loc} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{minMaxLoc}\PY{p}{(}\PY{n}{res}\PY{p}{)}
        
        
                \PY{n}{top\PYZus{}left} \PY{o}{=} \PY{n}{min\PYZus{}loc}
                \PY{n}{bottom\PYZus{}right} \PY{o}{=} \PY{p}{(}\PY{n}{top\PYZus{}left}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{+} \PY{n}{w}\PY{p}{,} \PY{n}{top\PYZus{}left}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{n}{h}\PY{p}{)}
                \PY{n}{cv2}\PY{o}{.}\PY{n}{rectangle}\PY{p}{(}\PY{n}{target}\PY{p}{,} \PY{n}{top\PYZus{}left}\PY{p}{,} \PY{n}{bottom\PYZus{}right}\PY{p}{,} \PY{l+m+mi}{255}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
        
                \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}\PY{p}{)}
                \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{121}\PY{p}{)}\PY{p}{;} \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{res}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Convolution Response}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{l+m+mi}{24}\PY{p}{)}\PY{p}{;} \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{122}\PY{p}{)}\PY{p}{;} \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{target}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Detection}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{l+m+mi}{24}\PY{p}{)}\PY{p}{;} \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}\PY{p}{;}
                
            \PY{k}{elif} \PY{n}{number} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{many}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                \PY{n}{target\PYZus{}rgb} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{target\PYZus{}image\PYZus{}path}\PY{p}{)}
                \PY{n}{target\PYZus{}gray} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{cvtColor}\PY{p}{(}\PY{n}{target\PYZus{}rgb}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{COLOR\PYZus{}BGR2GRAY}\PY{p}{)}
                \PY{n}{template} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{template\PYZus{}path}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
                
                \PY{n}{method} \PY{o}{=} \PY{n+nb}{eval}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cv2.TM\PYZus{}CCOEFF\PYZus{}NORMED}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{h} \PY{p}{,} \PY{n}{w} \PY{o}{=} \PY{n}{template}\PY{o}{.}\PY{n}{shape}
                
                \PY{n}{res} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{matchTemplate}\PY{p}{(}\PY{n}{target\PYZus{}gray}\PY{p}{,} \PY{n}{template}\PY{p}{,} \PY{n}{method}\PY{p}{)}
                \PY{n}{loc} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{res} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{n}{threshold}\PY{p}{)}
                
                \PY{k}{for} \PY{n}{point} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{o}{*}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
                    \PY{n}{cv2}\PY{o}{.}\PY{n}{rectangle}\PY{p}{(}\PY{n}{target\PYZus{}rgb}\PY{p}{,} \PY{n}{point}\PY{p}{,} \PY{p}{(}\PY{n}{point}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{+} \PY{n}{w}\PY{p}{,} \PY{n}{point}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{n}{h}\PY{p}{)}\PY{p}{,} 
                                  \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{255}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
                    
                \PY{n}{cv2}\PY{o}{.}\PY{n}{imwrite}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{result.png}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{target\PYZus{}rgb}\PY{p}{)}
                \PY{n}{result} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{result.png}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{)}\PY{p}{)}
                \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{result}\PY{p}{)}\PY{p}{;} \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{;}
                \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Detection Results}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{size} \PY{o}{=} \PY{l+m+mi}{32}\PY{p}{)}\PY{p}{;}
                \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}\PY{p}{;}
            
                \PY{n}{os}\PY{o}{.}\PY{n}{remove}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{result.png}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{k}{else}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Enter Valid Number (one or many)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{n}{detect\PYZus{}features\PYZus{}opencv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/target.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/template.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                              \PY{n}{threshold}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_4_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{n}{detect\PYZus{}features\PYZus{}opencv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/target\PYZus{}street.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/template\PYZus{}human.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                              \PY{n}{threshold}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_5_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{n}{detect\PYZus{}features\PYZus{}opencv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/target\PYZus{}tennis.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/template\PYZus{}tennis.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                              \PY{n}{number} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{many}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{threshold} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_6_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    The \texttt{matchTemplate} function in openCV works very well both for
finding a single occurrence and for finding many matches. However, it
abstracts away most of the details, which does not give us a chance to
learn what is actually happening. To solve that, we can do the same
method but by hand. We are still abstracting away some of the details,
mostly in the convolution, but this approach gives us slightly more
insight into what \texttt{mathcTemplate} does for us.

    \hypertarget{implementation-by-hand}{%
\subsection{Implementation by Hand}\label{implementation-by-hand}}

This uses the Fast Fourier Transform Convolution in
\texttt{scipy.signal} to find the response to the template within the
target. Responses are normalized by the sum of responses for each
individual color channel.

    \hypertarget{normalization-functions}{%
\subsubsection{Normalization Functions}\label{normalization-functions}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{k}{def} \PY{n+nf}{\PYZus{}window\PYZus{}sum\PYZus{}2d}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{window\PYZus{}shape}\PY{p}{)}\PY{p}{:}
            \PY{n}{window\PYZus{}sum} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
            \PY{n}{window\PYZus{}sum} \PY{o}{=} \PY{p}{(}\PY{n}{window\PYZus{}sum}\PY{p}{[}\PY{n}{window\PYZus{}shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} 
                         \PY{n}{window\PYZus{}sum}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{n}{window\PYZus{}shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
            
            \PY{n}{window\PYZus{}sum} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{window\PYZus{}sum}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{n}{window\PYZus{}sum} \PY{o}{=} \PY{p}{(}\PY{n}{window\PYZus{}sum}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{window\PYZus{}shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}}
                         \PY{n}{window\PYZus{}sum}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{o}{\PYZhy{}}\PY{n}{window\PYZus{}shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
            
            \PY{k}{return} \PY{n}{window\PYZus{}sum}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{k}{def} \PY{n+nf}{\PYZus{}window\PYZus{}sum\PYZus{}3d}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{window\PYZus{}shape}\PY{p}{)}\PY{p}{:}
            \PY{n}{window\PYZus{}sum} \PY{o}{=} \PY{n}{\PYZus{}window\PYZus{}sum\PYZus{}2d}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{window\PYZus{}shape}\PY{p}{)}
            
            \PY{n}{window\PYZus{}sum} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{window\PYZus{}sum}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
            \PY{n}{window\PYZus{}sum} \PY{o}{=} \PY{p}{(}\PY{n}{window\PYZus{}sum}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{n}{window\PYZus{}shape}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} 
                          \PY{n}{window\PYZus{}sum}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{o}{\PYZhy{}}\PY{n}{window\PYZus{}shape}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
            
            \PY{k}{return} \PY{n}{window\PYZus{}sum}
\end{Verbatim}


    \hypertarget{feature-detection-implementation}{%
\subsection{Feature Detection
Implementation}\label{feature-detection-implementation}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{k}{def} \PY{n+nf}{detect\PYZus{}features}\PY{p}{(}\PY{n}{image\PYZus{}path}\PY{p}{,} \PY{n}{template\PYZus{}path}\PY{p}{,} \PY{n}{pad\PYZus{}input}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} 
                            \PY{n}{mode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{constant}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{constant\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
            
            \PY{n}{image} \PY{o}{=} \PY{n}{Image}\PY{o}{.}\PY{n}{open}\PY{p}{(}\PY{n}{image\PYZus{}path}\PY{p}{)}
            \PY{n}{image} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{,} \PY{n}{copy}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
        
            \PY{n}{orig\PYZus{}image} \PY{o}{=} \PY{n}{image}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{uint8}\PY{p}{)}
            
            \PY{n}{template} \PY{o}{=} \PY{n}{Image}\PY{o}{.}\PY{n}{open}\PY{p}{(}\PY{n}{template\PYZus{}path}\PY{p}{)}
            \PY{n}{template} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{template}\PY{p}{)}
            
            \PY{k}{if} \PY{n}{image}\PY{o}{.}\PY{n}{ndim} \PY{o}{\PYZlt{}} \PY{n}{template}\PY{o}{.}\PY{n}{ndim}\PY{p}{:}
                \PY{k}{raise} \PY{n+ne}{ValueError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Dimensionaliy of template must be less than or equal}\PY{l+s+s2}{\PYZdq{}}
                                 \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ to the dimensionality of image.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
            \PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{less}\PY{p}{(}\PY{n}{image}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                \PY{k}{raise} \PY{n+ne}{ValueError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Image must be larger than templtate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
                
            \PY{n}{image\PYZus{}shape} \PY{o}{=} \PY{n}{image}\PY{o}{.}\PY{n}{shape}
            
            \PY{n}{pad\PYZus{}width} \PY{o}{=} \PY{n+nb}{tuple}\PY{p}{(}\PY{p}{(}\PY{n}{width}\PY{p}{,} \PY{n}{width}\PY{p}{)} \PY{k}{for} \PY{n}{width} \PY{o+ow}{in} \PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
            
            \PY{k}{if} \PY{n}{mode} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{constant}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                \PY{n}{image} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{pad}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{pad\PYZus{}width}\PY{o}{=}\PY{n}{pad\PYZus{}width}\PY{p}{,} \PY{n}{mode}\PY{o}{=}\PY{n}{mode}\PY{p}{,}
                              \PY{n}{constant\PYZus{}values}\PY{o}{=}\PY{n}{constant\PYZus{}value}\PY{p}{)}
            \PY{k}{else}\PY{p}{:}
                \PY{n}{image} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{pad}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{pad\PYZus{}width}\PY{o}{=}\PY{n}{pad\PYZus{}width}\PY{p}{,} \PY{n}{mode}\PY{o}{=}\PY{n}{mode}\PY{p}{)}
                
            \PY{k}{if} \PY{n}{image}\PY{o}{.}\PY{n}{ndim} \PY{o}{==} \PY{l+m+mi}{2}\PY{p}{:}
                \PY{n}{image\PYZus{}window\PYZus{}sum} \PY{o}{=} \PY{n}{\PYZus{}window\PYZus{}sum\PYZus{}2d}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
                \PY{n}{image\PYZus{}window\PYZus{}sum2} \PY{o}{=} \PY{n}{\PYZus{}window\PYZus{}sum\PYZus{}2d}\PY{p}{(}\PY{n}{image} \PY{o}{*}\PY{o}{*} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
                
            \PY{k}{elif} \PY{n}{image}\PY{o}{.}\PY{n}{ndim} \PY{o}{==} \PY{l+m+mi}{3}\PY{p}{:}
                \PY{n}{image\PYZus{}window\PYZus{}sum} \PY{o}{=} \PY{n}{\PYZus{}window\PYZus{}sum\PYZus{}3d}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
                \PY{n}{image\PYZus{}window\PYZus{}sum2} \PY{o}{=} \PY{n}{\PYZus{}window\PYZus{}sum\PYZus{}3d}\PY{p}{(}\PY{n}{image} \PY{o}{*}\PY{o}{*} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
                
            \PY{n}{template\PYZus{}mean} \PY{o}{=} \PY{n}{template}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
            \PY{n}{template\PYZus{}volume} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{prod}\PY{p}{(}\PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
            \PY{n}{template\PYZus{}ssd} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{(}\PY{n}{template} \PY{o}{\PYZhy{}} \PY{n}{template\PYZus{}mean}\PY{p}{)} \PY{o}{*}\PY{o}{*} \PY{l+m+mi}{2}\PY{p}{)}
            
            \PY{k}{if} \PY{n}{image}\PY{o}{.}\PY{n}{ndim} \PY{o}{==} \PY{l+m+mi}{2}\PY{p}{:}
                \PY{n}{xcorr} \PY{o}{=} \PY{n}{fftconvolve}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{template}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
                                   \PY{n}{mode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{valid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
            \PY{k}{elif} \PY{n}{image}\PY{o}{.}\PY{n}{ndim} \PY{o}{==} \PY{l+m+mi}{3}\PY{p}{:}
                \PY{n}{xcorr} \PY{o}{=} \PY{n}{fftconvolve}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{template}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
                                   \PY{n}{mode} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{valid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
                
            \PY{c+c1}{\PYZsh{} Normalization}
            \PY{n}{numerator} \PY{o}{=} \PY{n}{xcorr} \PY{o}{\PYZhy{}} \PY{n}{image\PYZus{}window\PYZus{}sum} \PY{o}{*} \PY{n}{template\PYZus{}mean}
            \PY{n}{denominator} \PY{o}{=} \PY{n}{image\PYZus{}window\PYZus{}sum2}
            \PY{n}{np}\PY{o}{.}\PY{n}{multiply}\PY{p}{(}\PY{n}{image\PYZus{}window\PYZus{}sum}\PY{p}{,} \PY{n}{image\PYZus{}window\PYZus{}sum}\PY{p}{,} \PY{n}{out}\PY{o}{=}\PY{n}{image\PYZus{}window\PYZus{}sum}\PY{p}{)}
            \PY{n}{np}\PY{o}{.}\PY{n}{divide}\PY{p}{(}\PY{n}{image\PYZus{}window\PYZus{}sum}\PY{p}{,} \PY{n}{template\PYZus{}volume}\PY{p}{,} \PY{n}{out}\PY{o}{=}\PY{n}{image\PYZus{}window\PYZus{}sum}\PY{p}{)}
            \PY{n}{denominator} \PY{o}{=} \PY{n}{denominator} \PY{o}{\PYZhy{}} \PY{n}{image\PYZus{}window\PYZus{}sum}
            \PY{n}{denominator} \PY{o}{=} \PY{n}{denominator} \PY{o}{*} \PY{n}{template\PYZus{}ssd}
            \PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{n}{denominator}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{out}\PY{o}{=}\PY{n}{denominator}\PY{p}{)}
            \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{denominator}\PY{p}{,} \PY{n}{out}\PY{o}{=}\PY{n}{denominator}\PY{p}{)}
            
            \PY{n}{response} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros\PYZus{}like}\PY{p}{(}\PY{n}{xcorr}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
            
            \PY{n}{mask} \PY{o}{=} \PY{n}{denominator} \PY{o}{\PYZgt{}} \PY{n}{np}\PY{o}{.}\PY{n}{finfo}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{)}\PY{o}{.}\PY{n}{eps}
            
            \PY{n}{response}\PY{p}{[}\PY{n}{mask}\PY{p}{]} \PY{o}{=} \PY{n}{numerator}\PY{p}{[}\PY{n}{mask}\PY{p}{]} \PY{o}{/} \PY{n}{denominator}\PY{p}{[}\PY{n}{mask}\PY{p}{]}
            
            \PY{n}{slices} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{template}\PY{o}{.}\PY{n}{ndim}\PY{p}{)}\PY{p}{:}
                \PY{k}{if} \PY{n}{pad\PYZus{}input}\PY{p}{:}
                    \PY{n}{d0} \PY{o}{=} \PY{p}{(}\PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{/}\PY{o}{/} \PY{l+m+mi}{2}
                    \PY{n}{d1} \PY{o}{=} \PY{n}{d0} \PY{o}{+} \PY{n}{image\PYZus{}shape}\PY{p}{[}\PY{n}{i}\PY{p}{]}
                \PY{k}{else}\PY{p}{:}
                    \PY{n}{d0} \PY{o}{=} \PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}
                    \PY{n}{d1} \PY{o}{=} \PY{n}{d0} \PY{o}{+} \PY{n}{image\PYZus{}shape}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+} \PY{l+m+mi}{1}
                \PY{n}{slices}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n+nb}{slice}\PY{p}{(}\PY{n}{d0}\PY{p}{,} \PY{n}{d1}\PY{p}{)}\PY{p}{)}
            
            \PY{k}{return} \PY{n}{orig\PYZus{}image}\PY{p}{,} \PY{n}{template}\PY{p}{,} \PY{n}{response}\PY{p}{[}\PY{n}{slices}\PY{p}{]}
                
\end{Verbatim}


    \hypertarget{model-to-carry-out-the-procedure}{%
\subsection{Model to Carry out the
Procedure}\label{model-to-carry-out-the-procedure}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{k}{def} \PY{n+nf}{model}\PY{p}{(}\PY{n}{image\PYZus{}path}\PY{p}{,} \PY{n}{template\PYZus{}path}\PY{p}{,} \PY{n}{number} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{many}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                  \PY{n}{threshold} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{analyze} \PY{o}{=} \PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
            
            \PY{n}{image}\PY{p}{,} \PY{n}{template}\PY{p}{,} \PY{n}{response} \PY{o}{=} \PY{n}{detect\PYZus{}features}\PY{p}{(}\PY{n}{image\PYZus{}path}\PY{p}{,} \PY{n}{template\PYZus{}path}\PY{p}{,} 
                                                       \PY{n}{pad\PYZus{}input}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
            
            \PY{k}{if} \PY{o+ow}{not} \PY{n}{analyze}\PY{p}{:}
                \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
                \PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
                \PY{n}{ax1}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{template}\PY{p}{)}
                \PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}axis\PYZus{}off}\PY{p}{(}\PY{p}{)}
                \PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Template}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{size} \PY{o}{=} \PY{l+m+mi}{20}\PY{p}{)}
                \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
                \PY{n}{fig}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
                \PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{121}\PY{p}{,} \PY{n}{adjustable} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{box\PYZhy{}forced}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{ax3} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{122}\PY{p}{,} \PY{n}{sharex} \PY{o}{=} \PY{n}{ax2}\PY{p}{,} \PY{n}{sharey} \PY{o}{=} \PY{n}{ax2}\PY{p}{,} \PY{n}{adjustable} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{box\PYZhy{}forced}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                
            \PY{k}{else}\PY{p}{:}
                \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}
                \PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{111}\PY{p}{)}
            
            \PY{n}{ax2}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{image}\PY{p}{)}
            \PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}axis\PYZus{}off}\PY{p}{(}\PY{p}{)}
            \PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Target Image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{size} \PY{o}{=} \PY{l+m+mi}{20}\PY{p}{)}
                
            \PY{n}{htemplate}\PY{p}{,} \PY{n}{wtemplate} \PY{o}{=} \PY{n}{template}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}
            
            \PY{k}{if} \PY{n}{number} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{many}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                \PY{n}{detections} \PY{o}{=} \PY{l+m+mi}{0}
                
                \PY{n}{pos} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{response}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{threshold}\PY{p}{)}\PY{p}{)}
                
                \PY{n}{recorded\PYZus{}boxes} \PY{o}{=} \PY{p}{[}\PY{p}{]} 
                
                
                \PY{n}{positions} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                \PY{k}{for} \PY{n}{position} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{pos}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
                    \PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{z} \PY{o}{=} \PY{n}{pos}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{position}\PY{p}{]}
                    \PY{n}{value} \PY{o}{=} \PY{n}{response}\PY{p}{[}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{z}\PY{p}{]}
                    \PY{n}{positions}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{z}\PY{p}{,} \PY{n}{value}\PY{p}{)}\PY{p}{)}
                    
                \PY{n}{positions} \PY{o}{=} \PY{n+nb}{sorted}\PY{p}{(}\PY{n}{positions}\PY{p}{,} \PY{n}{key} \PY{o}{=} \PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{x}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{,} \PY{n}{reverse} \PY{o}{=} \PY{k+kc}{True}\PY{p}{)}
                
                \PY{k}{for} \PY{n}{entry} \PY{o+ow}{in} \PY{n}{positions}\PY{p}{:}
        
                    \PY{n}{y}\PY{p}{,} \PY{n}{x} \PY{o}{=} \PY{n}{entry}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}
                    
                    \PY{n}{record} \PY{o}{=} \PY{k+kc}{False}
                    
                    \PY{k}{for} \PY{n}{box} \PY{o+ow}{in} \PY{n}{recorded\PYZus{}boxes}\PY{p}{:}
                        
                        \PY{n}{left}\PY{p}{,} \PY{n}{right}\PY{p}{,} \PY{n}{bottom}\PY{p}{,} \PY{n}{top} \PY{o}{=} \PY{n}{box}
                        
                        \PY{k}{if} \PY{p}{(}\PY{n}{x} \PY{o}{\PYZgt{}} \PY{n}{left}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{x} \PY{o}{\PYZlt{}} \PY{n}{right}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{y} \PY{o}{\PYZgt{}} \PY{n}{bottom}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{y} \PY{o}{\PYZlt{}} \PY{n}{top}\PY{p}{)}\PY{p}{:}
                            \PY{n}{record} \PY{o}{=} \PY{k+kc}{True}
                    
                    \PY{k}{if} \PY{o+ow}{not} \PY{n}{record}\PY{p}{:}
                        \PY{n}{rank} \PY{o}{=} \PY{n}{detections}
                        
                        \PY{c+c1}{\PYZsh{} left, right, bottom, top}
                        \PY{n}{bounding\PYZus{}box} \PY{o}{=} \PY{p}{(}\PY{n}{x} \PY{o}{\PYZhy{}} \PY{n}{wtemplate} \PY{o}{/} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{x} \PY{o}{+} \PY{n}{wtemplate} \PY{o}{/} \PY{l+m+mi}{2}\PY{p}{,} 
                                        \PY{n}{y} \PY{o}{\PYZhy{}} \PY{n}{htemplate} \PY{o}{/} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{y} \PY{o}{+} \PY{n}{htemplate} \PY{o}{/} \PY{l+m+mi}{2}\PY{p}{)}
        
                        \PY{n}{recorded\PYZus{}boxes}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{bounding\PYZus{}box}\PY{p}{)}
        
                        \PY{n}{rect} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{Rectangle}\PY{p}{(}\PY{p}{(}\PY{n}{x} \PY{o}{\PYZhy{}} \PY{n}{wtemplate} \PY{o}{/} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{y} \PY{o}{\PYZhy{}} \PY{n}{htemplate} \PY{o}{/} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} 
                                         \PY{n}{wtemplate}\PY{p}{,} \PY{n}{htemplate}\PY{p}{,} 
                                             \PY{n}{edgecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{none}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{lw} \PY{o}{=} \PY{l+m+mi}{4}\PY{p}{)}
                        \PY{n}{ax2}\PY{o}{.}\PY{n}{add\PYZus{}patch}\PY{p}{(}\PY{n}{rect}\PY{p}{)}
        
                        \PY{k}{if} \PY{o+ow}{not} \PY{n}{analyze}\PY{p}{:}
                            \PY{n}{ax3}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x}\PY{p}{,}  \PY{n}{y}\PY{p}{,} \PY{n}{marker} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{rank} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} 
                                     \PY{n}{ms} \PY{o}{=} \PY{l+m+mi}{32}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.6}\PY{p}{)}
        
                        \PY{n}{detections} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
                
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ detections with threshold: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{detections}\PY{p}{,} \PY{n}{threshold}\PY{p}{)}\PY{p}{)}
            
            \PY{k}{elif} \PY{n}{number} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{one}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                \PY{n}{ij} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{unravel\PYZus{}index}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{response}\PY{p}{)}\PY{p}{,} \PY{n}{response}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
        
                \PY{n}{y}\PY{p}{,} \PY{n}{x} \PY{o}{=} \PY{n}{ij}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}
        
                \PY{n}{rect} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{Rectangle}\PY{p}{(}\PY{p}{(}\PY{n}{x} \PY{o}{\PYZhy{}} \PY{n}{wtemplate} \PY{o}{/} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{y} \PY{o}{\PYZhy{}} \PY{n}{htemplate} \PY{o}{/} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} 
                                     \PY{n}{wtemplate}\PY{p}{,} \PY{n}{htemplate}\PY{p}{,} \PY{n}{edgecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                                     \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{none}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{lw} \PY{o}{=} \PY{l+m+mi}{4}\PY{p}{)}
                \PY{n}{ax2}\PY{o}{.}\PY{n}{add\PYZus{}patch}\PY{p}{(}\PY{n}{rect}\PY{p}{)}
                \PY{n}{circle} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{Circle}\PY{p}{(}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{)}\PY{p}{,} \PY{n}{radius} \PY{o}{=} \PY{l+m+mi}{6}\PY{p}{,}  \PY{n}{edgecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                    \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{none}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{lw} \PY{o}{=} \PY{l+m+mi}{4}\PY{p}{)}
                \PY{n}{ax3}\PY{o}{.}\PY{n}{add\PYZus{}patch}\PY{p}{(}\PY{n}{circle}\PY{p}{)}
            
            \PY{k}{if} \PY{o+ow}{not} \PY{n}{analyze}\PY{p}{:}
                \PY{n}{cax} \PY{o}{=} \PY{n}{ax3}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{response}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{n}{cm}\PY{o}{.}\PY{n}{coolwarm}\PY{p}{)}
                \PY{n}{fig}\PY{o}{.}\PY{n}{colorbar}\PY{p}{(}\PY{n}{cax}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{correlation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{orientation} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{horizontal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                             \PY{n}{shrink} \PY{o}{=} \PY{l+m+mf}{0.9}\PY{p}{,} \PY{n}{pad}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{)}
                \PY{n}{ax3}\PY{o}{.}\PY{n}{set\PYZus{}axis\PYZus{}off}\PY{p}{(}\PY{p}{)}
                \PY{n}{ax3}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Response from Feature Detection}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{size} \PY{o}{=} \PY{l+m+mi}{20}\PY{p}{)}
                \PY{n}{ax3}\PY{o}{.}\PY{n}{autoscale}\PY{p}{(}\PY{k+kc}{False}\PY{p}{)}
                \PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}anchor}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{N}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{ax3}\PY{o}{.}\PY{n}{set\PYZus{}anchor}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{N}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{n}{model}\PY{p}{(}\PY{n}{image\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/target\PYZus{}tennis.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
               \PY{n}{template\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/template\PYZus{}tennis.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{threshold}\PY{o}{=}\PY{l+m+mf}{0.85}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_16_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
6 detections with threshold: 0.85


    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_16_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{n}{model}\PY{p}{(}\PY{n}{image\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/target\PYZus{}tennis.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
               \PY{n}{template\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/template\PYZus{}tennis.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{threshold}\PY{o}{=}\PY{l+m+mf}{0.6}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_17_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
117 detections with threshold: 0.6


    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_17_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{n}{model}\PY{p}{(}\PY{n}{image\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/target\PYZus{}street.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
               \PY{n}{template\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/template\PYZus{}human.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{threshold}\PY{o}{=}\PY{l+m+mf}{0.8}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_18_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
1 detections with threshold: 0.8


    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_18_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{n}{model}\PY{p}{(}\PY{n}{image\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/target.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
               \PY{n}{template\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/template.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{threshold}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_19_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
1 detections with threshold: 0.9


    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_19_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{n}{model}\PY{p}{(}\PY{n}{image\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/target.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
               \PY{n}{template\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images/template.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{threshold}\PY{o}{=}\PY{l+m+mf}{0.6}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_20_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
1 detections with threshold: 0.6


    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_20_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We can see that the model is sensitive to different thresholds
especially when there are many occurrences of desired object within the
image. Overall, the model performs well for the simple cases where there
is only one clear case of the template object within the target but for
multiple objects does not perform as well. One issue with this approach
is using the same template to find objects that may be similar but not
exactly identical. This is clearly the case here and this method would
not work very well if we wanted to find many faces based on a single
face.

    \hypertarget{conclusions}{%
\section{Conclusions}\label{conclusions}}

We explored two implementations of template matching for feature
detection: using openCV and a built-in function, and carrying out the
same procedure ourselves one step at a time. Overall, the process is the
same for this basic implementation:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Choose a template image with the object we want to detect in the
  target image.
\item
  Convolve the template image with the target image for each color
  channel.
\item
  Normalize the response in each individual color channel.
\item
  Find the highest response (for a single occurrence), or all responses
  above a threshold (for multiple occurrences).
\item
  Conver the responses into integers between 0 and 255 and plot the
  results on the original image.
\item
  Compare the results with ground-truth, taken to be our opinion in this
  case, and adjust the threshold as needed.
\end{enumerate}

In the next notebook, we will look at the ROC curve, how changing the
threshold moves our location along a given ROC curve, and possible
approaches for shifting the entire curve by modifying the signal to
noise ratio. We will use the model built by hand for this exploration
because it gives us more control over visualizing the results to assess
the performance.


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
